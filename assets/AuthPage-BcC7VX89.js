import{r as e,j as s}from"./ui-CdBhIjHZ.js";import{s as a,B as r,C as t,b as i,c as l,d as o,a as n}from"./index-DCGLpGXa.js";import{u as c}from"./index-BHTt414G.js";import{I as d}from"./input-CjrF92sH.js";import{L as m}from"./label-DTBIM1Y9.js";import{T as u,a as p,b as h,c as x}from"./tabs-C60opJ2P.js";import{L as g}from"./Logo-7h1yqRHv.js";import{b as w,M as j,P as f,c as v,E as y,d as N}from"./icons-qmpYOd28.js";import"./supabase-BfaVHYeC.js";import"./vendor--zLKLCTa.js";import"./utils-BeLtu-UY.js";import"./utils-f_7zD0yq.js";class b extends Error{constructor(e,s){super(e),this.field=s,this.name="ValidationError"}}class S extends Error{constructor(e="Authentication required"){super(e),this.name="AuthenticationError"}}class C extends Error{constructor(e="Resource"){super(`${e} not found`),this.name="NotFoundError"}}const E=(e,s)=>{var a;const r=e=>String(e||"Unknown error").replace(/[\r\n\t<>"'&\x00-\x1f\x7f-\x9f]/g," ").substring(0,500);if(e instanceof b)return{message:r(e.message),code:"VALIDATION_ERROR",statusCode:400,details:{field:e.field}};if(e instanceof S)return{message:r(e.message),code:"AUTH_ERROR",statusCode:401};if(e instanceof C)return{message:r(e.message),code:"NOT_FOUND",statusCode:404};if(null==e?void 0:e.code)return{message:r(e.message||"Database error"),code:String(e.code).replace(/[^A-Z0-9_]/g,""),statusCode:500};if("NetworkError"===(null==e?void 0:e.name)||(null==(a=null==e?void 0:e.message)?void 0:a.includes("fetch")))return{message:"Network connection error. Please check your internet connection.",code:"NETWORK_ERROR",statusCode:503};return{message:s?`${s}: ${r((null==e?void 0:e.message)||"An unexpected error occurred")}`:r((null==e?void 0:e.message)||"An unexpected error occurred"),code:"GENERIC_ERROR",statusCode:500}},P=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e||"").trim()),_=e=>String(e||"").length>=8,R=e=>{const s=String(e||"").trim();return s.length>=1&&s.length<=50},q={},A=e=>String(e||"").replace(/[\x00-\x1f\x7f-\x9f]/g,"").replace(/[<>\"'&]/g,"").replace(/javascript:/gi,"").replace(/data:/gi,"").replace(/vbscript:/gi,"").replace(/on\w+=/gi,"").trim(),k=e=>String(e||"").replace(/[^+0-9\s\-()]/g,"").trim(),F=(e,s=1e3)=>{const a=A(e);if(a.length>s)throw new Error(`Input too long (max ${s} characters)`);return a};function I(e,s){return async(...s)=>{const a=performance.now();try{const a=await e(...s);performance.now();return a}catch(r){performance.now();throw r}}}(()=>{const e=null==q?void 0:q.VITE_SUPABASE_PROJECT_ID;if(!e||"your-project-id"===e)throw new Error("VITE_SUPABASE_PROJECT_ID must be configured for production")})();const O={signUp:I(async(e,s,r,t,i)=>{if(!P(e))throw new b("Valid email is required","email");if(!_(s))throw new b("Password must be at least 8 characters","password");if(!R(r)||!R(t))throw new b("First and last name are required","name");const l={first_name:F(r,50),last_name:F(t,50),phone:k(i).substring(0,20)},{data:o,error:n}=await a.auth.signUp({email:e.toLowerCase().trim(),password:s,options:{data:l}});if(n)throw n;return o}),signIn:I(async(e,s)=>{if(!e||!s)throw new b("Email and password are required");const{data:r,error:t}=await a.auth.signInWithPassword({email:e.toLowerCase().trim(),password:s});if(t)throw t;return r}),async signOut(){const{error:e}=await a.auth.signOut();if(e)throw e},async getSession(){const{data:e,error:s}=await a.auth.getSession();if(s)throw s;return e},async getProfile(){const{data:e,error:s}=await a.auth.getUser();if(s)throw s;return e},async resetPassword(e){try{if(!e||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))throw new b("Valid email is required","email");const s=`${window.location.origin}/reset-password`,{data:r,error:t}=await a.auth.resetPasswordForEmail(e.toLowerCase().trim(),{redirectTo:s});if(t)throw E(t,"Failed to send password reset email");return r}catch(s){if(s instanceof b)throw s;throw E(s,"Password reset failed")}}};function T({onSuccess:a,onBack:b,initialTab:S="signup"}){const[C,E]=e.useState(!1),[P,_]=e.useState({}),[R,q]=e.useState(!1),[A,k]=e.useState(!1),[F,I]=e.useState(!1),T=async e=>{e.preventDefault();const s=e.currentTarget,r=new FormData(s),t=String(r.get("email")||""),i=String(r.get("password")||""),l=String(r.get("phone")||""),o=String(r.get("confirm_password")||""),n={};if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(n.email="Enter a valid email"),i.length<8&&(n.password="Minimum 8 characters"),l&&!/^\+?[0-9\s-]{7,}$/.test(l)&&(n.phone="Enter a valid phone"),"signup"===s.dataset.mode&&o!==i&&(n.confirmPassword="Passwords do not match"),_(n),Object.keys(n).length>0){const e=s.querySelector('[aria-invalid="true"]');return void(e&&e.focus())}E(!0);try{if("signup"===s.dataset.mode){const e=String(r.get("first_name")||""),s=String(r.get("last_name")||"");await O.signUp(t,i,e,s,l)}else await O.signIn(t,i);a()}catch(d){c.error((null==d?void 0:d.message)||"Authentication failed")}finally{E(!1)}};return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-white to-secondary/5 flex items-center justify-center p-6",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs(r,{variant:"ghost",onClick:b,className:"mb-6",children:[s.jsx(w,{className:"w-4 h-4 mr-2"}),"Back to Home"]}),s.jsxs(t,{className:"shadow-xl",children:[s.jsxs(i,{className:"text-center",children:[s.jsx("div",{className:"flex justify-center mb-4",children:s.jsx(g,{size:"xl",showText:!1})}),s.jsx(l,{className:"text-3xl",children:"Welcome to Wassel"}),s.jsx(o,{children:"واصل - Share Your Journey"})]}),s.jsxs(n,{children:[s.jsxs(u,{defaultValue:S,className:"w-full",children:[s.jsxs(p,{className:"grid w-full grid-cols-2",children:[s.jsx(h,{value:"signup",children:"Sign Up"}),s.jsx(h,{value:"login",children:"Log In"})]}),s.jsx(x,{value:"signup",children:s.jsxs("form",{onSubmit:T,className:"space-y-4 mt-4","data-mode":"signup","aria-live":"polite",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"First Name"}),s.jsx(d,{placeholder:"First name",required:!0,autoComplete:"given-name",name:"first_name"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"Last Name"}),s.jsx(d,{placeholder:"Last name",required:!0,autoComplete:"family-name",name:"last_name"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"Email"}),s.jsxs("div",{className:"relative",children:[s.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(d,{type:"email",placeholder:"your@email.com",className:"pl-10",name:"email",autoComplete:"email",required:!0,"aria-invalid":!!P.email,"aria-describedby":P.email?"signup-email-error":void 0}),P.email&&s.jsx("p",{id:"signup-email-error",className:"mt-1 text-sm text-red-600",children:P.email})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"Phone Number"}),s.jsxs("div",{className:"relative",children:[s.jsx(f,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(d,{type:"tel",placeholder:"+971 50 123 4567",className:"pl-10",name:"phone",autoComplete:"tel",required:!0,"aria-invalid":!!P.phone,"aria-describedby":P.phone?"signup-phone-error":void 0}),P.phone&&s.jsx("p",{id:"signup-phone-error",className:"mt-1 text-sm text-red-600",children:P.phone})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(d,{type:R?"text":"password",placeholder:"••••••••",className:"pl-10",name:"password",autoComplete:"new-password",required:!0,"aria-invalid":!!P.password,"aria-describedby":P.password?"signup-password-error":"signup-password-hint"}),s.jsx("button",{type:"button","aria-label":R?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",onClick:()=>q(e=>!e),children:R?s.jsx(y,{className:"w-4 h-4"}):s.jsx(N,{className:"w-4 h-4"})}),P.password&&s.jsx("p",{id:"signup-password-error",className:"mt-1 text-sm text-red-600",children:P.password}),!P.password&&s.jsx("p",{id:"signup-password-hint",className:"mt-1 text-xs text-gray-500",children:"Min 8 chars, include uppercase, number, and symbol for best security."})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"Confirm Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(d,{type:A?"text":"password",placeholder:"••••••••",className:"pl-10",name:"confirm_password",autoComplete:"new-password","aria-invalid":!!P.confirmPassword,"aria-describedby":P.confirmPassword?"signup-confirm-error":void 0,required:!0}),s.jsx("button",{type:"button","aria-label":A?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",onClick:()=>k(e=>!e),children:A?s.jsx(y,{className:"w-4 h-4"}):s.jsx(N,{className:"w-4 h-4"})}),P.confirmPassword&&s.jsx("p",{id:"signup-confirm-error",className:"mt-1 text-sm text-red-600",children:P.confirmPassword})]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("input",{type:"checkbox",id:"terms",className:"mt-1",required:!0}),s.jsx("label",{htmlFor:"terms",className:"text-sm text-gray-600",children:"I agree to Wassel's Terms of Service and Privacy Policy"})]}),s.jsx(r,{type:"submit",className:"w-full bg-teal-600 hover:bg-teal-700",disabled:C,children:C?"Creating Account...":"Create Account"})]})}),s.jsx(x,{value:"login",children:s.jsxs("form",{onSubmit:T,className:"space-y-4 mt-4","data-mode":"login","aria-live":"polite",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{children:"Email"}),s.jsxs("div",{className:"relative",children:[s.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(d,{type:"email",placeholder:"your@email.com",className:"pl-10",name:"email",autoComplete:"email",required:!0,"aria-invalid":!!P.email,"aria-describedby":P.email?"login-email-error":void 0}),P.email&&s.jsx("p",{id:"login-email-error",className:"mt-1 text-sm text-red-600",children:P.email})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(m,{children:"Password"}),s.jsx("button",{type:"button",className:"text-sm text-teal-600 hover:text-teal-700",onClick:async()=>{const e=document.querySelector('form[data-mode="login"] input[name="email"]'),s=(null==e?void 0:e.value)||"";if(!s)return _(e=>({...e,email:"Enter your email to reset password"})),void(null==e||e.focus());if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return _(e=>({...e,email:"Enter a valid email"})),void(null==e||e.focus());try{await O.resetPassword(s),c.success("Password reset email sent. Check your inbox.")}catch(a){c.error((null==a?void 0:a.message)||"Failed to send reset email")}},children:"Forgot?"})]}),s.jsxs("div",{className:"relative",children:[s.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(d,{type:F?"text":"password",placeholder:"••••••••",className:"pl-10",name:"password",autoComplete:"current-password",required:!0,"aria-invalid":!!P.password,"aria-describedby":P.password?"login-password-error":void 0}),s.jsx("button",{type:"button","aria-label":F?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",onClick:()=>I(e=>!e),children:F?s.jsx(y,{className:"w-4 h-4"}):s.jsx(N,{className:"w-4 h-4"})}),P.password&&s.jsx("p",{id:"login-password-error",className:"mt-1 text-sm text-red-600",children:P.password})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"remember"}),s.jsx("label",{htmlFor:"remember",className:"text-sm text-gray-600",children:"Remember me"})]}),s.jsx(r,{type:"submit",className:"w-full bg-teal-600 hover:bg-teal-700",disabled:C,children:C?"Signing In...":"Sign In"})]})})]}),s.jsxs("div",{className:"mt-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("div",{className:"w-full border-t border-gray-200"})}),s.jsx("div",{className:"relative flex justify-center text-sm",children:s.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[s.jsxs(r,{variant:"outline",type:"button",children:[s.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",children:[s.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),s.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),s.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),s.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google"]}),s.jsxs(r,{variant:"outline",type:"button",children:[s.jsx("svg",{className:"w-5 h-5 mr-2",fill:"#1877F2",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),"Facebook"]})]})]})]})]}),s.jsx("p",{className:"text-center text-sm text-gray-600 mt-6",children:"By signing up, you agree to our commitment to safe and sustainable travel"})]})})}export{T as AuthPage};
